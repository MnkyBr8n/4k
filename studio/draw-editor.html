<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Draw Editor - 4K Studio</title>
  <link rel="stylesheet" href="css/studio.css"/>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --glass: rgba(255,255,255,0.1);
      --glass-strong: rgba(255,255,255,0.2);
      --glass-border: rgba(255,255,255,0.3);
      --primary: #667eea;
      --secondary: #764ba2;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      min-height: 100vh; 
      color: white;
      padding-top: 80px;
    }

    /* Studio Header */
    .studio-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.95);
      backdrop-filter: blur(10px);
      z-index: 1000;
      padding: 1rem 2rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .studio-nav {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .studio-logo {
      font-size: 1.5rem;
      font-weight: bold;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .studio-links {
      display: flex;
      gap: 2rem;
      list-style: none;
    }
    .studio-links a {
      color: white;
      text-decoration: none;
      transition: color 0.3s;
      font-size: 0.9rem;
    }
    .studio-links a:hover,
    .studio-links a.active {
      color: var(--primary);
    }

    /* Main Container */
    .draw-container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 2rem;
    }

    .page-title {
      text-align: center;
      margin-bottom: 2rem;
    }
    .page-title h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }
    .page-title p {
      opacity: 0.8;
      font-size: 1.1rem;
    }

    /* Canvas Size Selector */
    .canvas-setup {
      background: var(--glass);
      border-radius: 15px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      backdrop-filter: blur(10px);
    }
    .canvas-setup h3 {
      margin-bottom: 1rem;
    }
    .size-presets {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .preset-btn {
      padding: 0.75rem 1.5rem;
      background: rgba(255,255,255,0.1);
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.9rem;
    }
    .preset-btn:hover {
      background: rgba(255,255,255,0.2);
      border-color: var(--primary);
    }
    .preset-btn.active {
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      border-color: transparent;
    }

    /* Drawing App */
    .drawing-app {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 2rem;
      background: var(--glass);
      border-radius: 20px;
      padding: 2rem;
      backdrop-filter: blur(10px);
    }

    /* Left Panel */
    .left-panel {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      max-height: calc(100vh - 250px);
      overflow-y: auto;
    }
    .panel-section {
      background: var(--glass);
      border-radius: 15px;
      padding: 1.5rem;
    }
    .panel-section h3 {
      margin-bottom: 1rem;
      color: white;
      font-size: 1.1rem;
    }

    /* Color Wheel */
    .color-wheel-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }
    .color-wheel {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      position: relative;
      cursor: crosshair;
      background: conic-gradient(
        hsl(0, 100%, 50%),
        hsl(30, 100%, 50%),
        hsl(60, 100%, 50%),
        hsl(90, 100%, 50%),
        hsl(120, 100%, 50%),
        hsl(150, 100%, 50%),
        hsl(180, 100%, 50%),
        hsl(210, 100%, 50%),
        hsl(240, 100%, 50%),
        hsl(270, 100%, 50%),
        hsl(300, 100%, 50%),
        hsl(330, 100%, 50%),
        hsl(360, 100%, 50%)
      );
    }
    .color-picker {
      position: absolute;
      width: 12px;
      height: 12px;
      border: 2px solid white;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      box-shadow: 0 0 5px rgba(0,0,0,0.5);
    }
    .color-preview {
      display: flex;
      gap: 1rem;
      align-items: center;
      width: 100%;
    }
    .current-color {
      width: 50px;
      height: 30px;
      border: 2px solid white;
      border-radius: 6px;
      cursor: pointer;
      background: #000000;
    }
    .hex-input {
      flex: 1;
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      background: rgba(255,255,255,0.9);
      font-family: monospace;
      font-size: 0.9rem;
    }

    /* Color Swatches */
    .color-swatches {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 4px;
      margin-top: 1rem;
    }
    .color-swatch {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 3px;
      cursor: pointer;
      border: 1px solid rgba(255,255,255,0.4);
      transition: transform 0.2s, border-color 0.2s;
    }
    .color-swatch:hover {
      transform: scale(1.1);
      border-color: white;
    }

    /* Controls */
    .control-group {
      margin-bottom: 1rem;
    }
    .control-group label {
      display: block;
      color: white;
      font-size: 0.9rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    .control-group input,
    .control-group select {
      width: 100%;
      padding: 8px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      background: rgba(255,255,255,0.9);
    }
    .range-display {
      color: white;
      font-weight: bold;
      text-align: center;
      margin-top: 5px;
      font-size: 0.9rem;
    }

    /* Brush Preview */
    .brush-preview {
      width: 100%;
      height: 50px;
      background: rgba(255,255,255,0.9);
      border-radius: 8px;
      margin-top: 1rem;
      overflow: hidden;
    }
    .brush-preview canvas {
      width: 100%;
      height: 100%;
    }

    /* Layers */
    .layers-controls {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .layer-item {
      display: grid;
      grid-template-columns: 25px 1fr 60px;
      align-items: center;
      gap: 6px;
      background: rgba(255,255,255,0.08);
      padding: 6px 8px;
      border-radius: 6px;
      margin-bottom: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .layer-item:hover {
      background: rgba(255,255,255,0.15);
    }
    .layer-item.active {
      outline: 2px solid rgba(255,255,255,0.5);
      background: rgba(255,255,255,0.2);
    }
    .layer-visibility {
      width: 16px;
      height: 16px;
    }
    .layer-name {
      background: transparent;
      border: none;
      color: white;
      font-size: 11px;
      width: 100%;
      outline: none;
    }
    .layer-opacity {
      width: 50px;
      height: 16px;
    }

    /* Canvas Area */
    .canvas-area {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .canvas-container {
      position: relative;
      text-align: center;
      flex: 1;
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
      padding: 2rem;
    }
    #drawingCanvas {
      border: 4px solid rgba(255,255,255,0.4);
      border-radius: 15px;
      background: white;
      cursor: crosshair;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      max-width: 100%;
      height: auto;
    }

    /* Buttons */
    .btn {
      padding: 10px 20px;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      border: none;
      border-radius: 25px;
      color: white;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }
    .btn.secondary {
      background: rgba(255,255,255,0.2);
      border: 1px solid var(--glass-border);
    }
    .btn.secondary:hover {
      background: var(--glass-strong);
    }
    .btn.small {
      padding: 6px 12px;
      font-size: 0.8rem;
    }
    .btn.studio-primary {
      background: linear-gradient(45deg, #ff6b6b, #ff8e53);
    }
    .canvas-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Upload Area */
    .upload-area {
      border: 2px dashed rgba(255,255,255,0.3);
      border-radius: 8px;
      padding: 1.5rem;
      text-align: center;
      transition: all 0.3s;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .upload-area:hover,
    .upload-area.dragover {
      border-color: rgba(255,255,255,0.6);
      background: rgba(255,255,255,0.1);
    }
    .upload-area input[type="file"] {
      display: none;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(5px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.95), rgba(118, 75, 162, 0.95));
      border-radius: 20px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }
    .modal-header {
      margin-bottom: 1.5rem;
    }
    .modal-header h2 {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
    }
    .modal-body {
      margin-bottom: 1.5rem;
    }
    .modal-footer {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    /* Form Elements in Modal */
    .form-group {
      margin-bottom: 1.5rem;
    }
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: bold;
      font-size: 0.9rem;
    }
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      background: rgba(255,255,255,0.95);
    }
    .form-group select {
      cursor: pointer;
    }

    /* Radio Group */
    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .radio-option {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .radio-option:hover {
      background: rgba(255,255,255,0.2);
    }
    .radio-option input[type="radio"] {
      width: auto;
      cursor: pointer;
    }
    .radio-option label {
      cursor: pointer;
      margin: 0;
      flex: 1;
    }

    /* Conditional Fields */
    .conditional-field {
      display: none;
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
    }
    .conditional-field.active {
      display: block;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 100px;
      right: 2rem;
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
      z-index: 3000;
      display: none;
      animation: slideIn 0.3s ease;
    }
    .notification.active {
      display: block;
    }
    .notification.success {
      background: linear-gradient(45deg, #00b09b, #96c93d);
    }
    .notification.error {
      background: linear-gradient(45deg, #ff416c, #ff4b2b);
    }
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.3);
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255,255,255,0.5);
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .drawing-app {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      .left-panel {
        flex-direction: row;
        overflow-x: auto;
        gap: 1rem;
        max-height: none;
      }
      .panel-section {
        min-width: 280px;
        flex-shrink: 0;
      }
    }
    @media (max-width: 768px) {
      .left-panel {
        flex-direction: column;
        overflow-x: visible;
      }
      .panel-section {
        min-width: auto;
      }
      .page-title h1 {
        font-size: 2rem;
      }
      .canvas-actions {
        flex-direction: column;
        align-items: stretch;
      }
      .btn {
        width: 100%;
      }
      .studio-links {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Studio Header -->
  <header class="studio-header">
    <nav class="studio-nav">
      <div class="studio-logo">4K Studio</div>
      <ul class="studio-links">
        <li><a href="index.html">Dashboard</a></li>
        <li><a href="characters.html">Characters</a></li>
        <li><a href="images.html">Images</a></li>
        <li><a href="draw-editor.html" class="active">Draw Editor</a></li>
        <li><a href="hero-editor.html">Hero Themes</a></li>
        <li><a href="#" onclick="logout()">Logout</a></li>
      </ul>
    </nav>
  </header>

  <!-- Main Container -->
  <div class="draw-container">
    <!-- Page Title -->
    <div class="page-title">
      <h1>🎨 Draw Editor</h1>
      <p>Create and edit artwork for your characters and hero backgrounds</p>
    </div>

    <!-- Canvas Size Setup -->
    <div class="canvas-setup">
      <h3>Canvas Size</h3>
      <div class="size-presets">
        <button class="preset-btn active" data-width="800" data-height="600">
          Standard (800×600)
        </button>
        <button class="preset-btn" data-width="1920" data-height="1080">
          Hero Background (1920×1080)
        </button>
        <button class="preset-btn" data-width="800" data-height="1000">
          Character Portrait (800×1000)
        </button>
        <button class="preset-btn" data-width="1000" data-height="1000">
          Square (1000×1000)
        </button>
      </div>
    </div>

    <!-- Drawing App -->
    <div class="drawing-app">
      <!-- Left Panel: Tools -->
      <div class="left-panel">
        <!-- Color Picker -->
        <div class="panel-section">
          <h3>Color</h3>
          <div class="color-wheel-container">
            <div class="color-wheel" id="colorWheel">
              <div class="color-picker" id="colorPicker"></div>
            </div>
            <div class="color-preview">
              <div class="current-color" id="currentColor"></div>
              <input type="text" class="hex-input" id="hexInput" value="#000000" maxlength="7">
            </div>
            <div class="color-swatches" id="colorSwatches"></div>
          </div>
        </div>

        <!-- Brush Settings -->
        <div class="panel-section">
          <h3>Brush</h3>
          <div class="control-group">
            <label for="brushSize">Size</label>
            <input type="range" id="brushSize" min="1" max="50" value="5">
            <div class="range-display" id="sizeDisplay">5px</div>
          </div>
          <div class="control-group">
            <label for="brushOpacity">Opacity</label>
            <input type="range" id="brushOpacity" min="0" max="100" value="100">
            <div class="range-display" id="opacityDisplay">100%</div>
          </div>
          <div class="control-group">
            <label for="brushType">Type</label>
            <select id="brushType">
              <option value="round">Round</option>
              <option value="square">Square</option>
              <option value="spray">Spray</option>
            </select>
          </div>
          <div class="brush-preview">
            <canvas id="brushPreviewCanvas" width="300" height="50"></canvas>
          </div>
        </div>

        <!-- Layers -->
        <div class="panel-section">
          <h3>Layers</h3>
          <div class="layers-controls">
            <button class="btn small" onclick="drawingApp.addLayer()">+ Add</button>
            <button class="btn small secondary" onclick="drawingApp.deleteActiveLayer()">Delete</button>
            <button class="btn small secondary" onclick="drawingApp.mergeDown()">Merge</button>
          </div>
          <div id="layersList"></div>
        </div>

        <!-- Upload -->
        <div class="panel-section">
          <h3>Import Image</h3>
          <div class="upload-area" onclick="document.getElementById('imageUpload').click()">
            <p>📁 Click or Drag & Drop</p>
            <input type="file" id="imageUpload" accept="image/*" multiple>
          </div>
        </div>
      </div>

      <!-- Canvas Area -->
      <div class="canvas-area">
        <div class="canvas-container">
          <canvas id="drawingCanvas" width="800" height="600"></canvas>
        </div>

        <!-- Actions -->
        <div class="canvas-actions">
          <button class="btn secondary" onclick="drawingApp.clearActiveLayer()">Clear Layer</button>
          <button class="btn secondary" onclick="drawingApp.undoLastStroke()">↶ Undo</button>
          <button class="btn secondary" onclick="drawingApp.redoLastStroke()">↷ Redo</button>
          <button class="btn studio-primary" onclick="openSaveDialog()">💾 Save to Studio</button>
          <button class="btn" onclick="openLoadDialog()">📂 Load from Studio</button>
          <button class="btn secondary" onclick="drawingApp.saveAsImage()">⬇ Download Copy</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Save to Studio Modal -->
  <div class="modal" id="saveModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>💾 Save to Studio</h2>
        <p>Choose where to save your artwork</p>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Save As:</label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" name="saveType" value="hero" id="saveHero" checked>
              <label for="saveHero">
                <strong>Hero Background</strong><br>
                <small>For main site hero section</small>
              </label>
            </div>
            <div class="radio-option">
              <input type="radio" name="saveType" value="character" id="saveCharacter">
              <label for="saveCharacter">
                <strong>Character Artwork</strong><br>
                <small>Add to character's gallery</small>
              </label>
            </div>
            <div class="radio-option">
              <input type="radio" name="saveType" value="download" id="saveDownload">
              <label for="saveDownload">
                <strong>Download Only</strong><br>
                <small>Save to your device</small>
              </label>
            </div>
          </div>
        </div>

        <!-- Character Options (shown when character is selected) -->
        <div class="conditional-field" id="characterOptions">
          <div class="form-group">
            <label for="characterSelect">Character:</label>
            <select id="characterSelect">
              <option value="">Select character...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="albumSelect">Album:</label>
            <select id="albumSelect">
              <option value="digital">Digital</option>
              <option value="analog">Analog</option>
              <option value="in-progress">In Progress</option>
            </select>
          </div>
        </div>

        <!-- Filename -->
        <div class="form-group">
          <label for="filenameInput">Filename:</label>
          <input type="text" id="filenameInput" placeholder="my-artwork.png">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn secondary" onclick="closeSaveDialog()">Cancel</button>
        <button class="btn studio-primary" onclick="saveToStudio()">Save</button>
      </div>
    </div>
  </div>

  <!-- Load from Studio Modal -->
  <div class="modal" id="loadModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>📂 Load from Studio</h2>
        <p>Select an image to edit</p>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Load From:</label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" name="loadType" value="hero" id="loadHero" checked>
              <label for="loadHero">Hero Backgrounds</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="loadType" value="character" id="loadCharacter">
              <label for="loadCharacter">Character Images</label>
            </div>
          </div>
        </div>

        <!-- Character selector for loading character images -->
        <div class="conditional-field" id="loadCharacterOptions">
          <div class="form-group">
            <label for="loadCharacterSelect">Character:</label>
            <select id="loadCharacterSelect">
              <option value="">Select character...</option>
            </select>
          </div>
        </div>

        <!-- Image list -->
        <div class="form-group">
          <label>Available Images:</label>
          <select id="imageList" size="5" style="height: 150px;">
            <option value="">Loading...</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn secondary" onclick="closeLoadDialog()">Cancel</button>
        <button class="btn" onclick="loadFromStudio()">Load</button>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification"></div>

  <!-- Scripts -->
  <script src="js/store.js"></script>
  <script src="js/draw-integration.js"></script>
  <script src="js/draw-editor.js"></script>
</body>
</html>
